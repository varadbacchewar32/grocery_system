{% extends "base.html" %}
{% block content %}
{% include 'owner-navbar.html' %}
{% block owner_navbar %}{% endblock owner_navbar %}

<div class="page-container">

<h2 class="page-title">ðŸ“¦ Inventory Management</h2>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- Add / Update Inventory -->
<div class="section-card mb-4">
  <h5 class="fw-semibold mb-3">Add / Update Stock</h5>
  <form method="POST" action="/update_inventory" enctype="application/x-www-form-urlencoded">
    <div class="row g-3 align-items-end">
      <div class="col-md-5">
        <label class="form-label">Product</label>
        <select name="product_id" class="form-select" required>
          <option value="">Select Product</option>
          {% for product in products %}
          <option value="{{ product.product_id }}">{{ product.product_name }} (â‚¹{{ product.rate }}/{{ product.unit }})</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Quantity</label>
        <input type="number" name="quantity" class="form-control" placeholder="Enter quantity" min="0" required>
      </div>
      <div class="col-md-2 d-grid">
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-save"></i> Save
        </button>
      </div>
    </div>
  </form>
</div>

<!-- Inventory Table -->
<div class="section-card">
  <h5 class="fw-semibold mb-3">Inventory List</h5>
  <div class="table-responsive">
    <table class="table table-hover align-middle text-center">
      <thead>
        <tr>
          <th>Item Name</th>
          <th>Rate</th>
          <th>Quantity</th>
          <th>Total Price</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% if inventory_items %}
          {% for item in inventory_items %}
          <tr>
            <td class="text-start fw-semibold">{{ item.product.product_name }}</td>
            <td>â‚¹{{ item.product.rate }} / {{ item.product.unit }}</td>
            <td>{{ item.quantity }} {{ item.product.unit }}</td>
            <td class="fw-bold text-primary">â‚¹{{ item.quantity * item.product.rate }}</td>
            <td>
              <form method="POST" action="/generate_bill" enctype="application/x-www-form-urlencoded" class="d-flex gap-2 align-items-center">
                <input type="hidden" name="inventory_id" value="{{ item.inventory_id }}">
                <input type="hidden" name="product_id" value="{{ item.product_id }}">
                <input type="hidden" name="rate" value="{{ item.product.rate }}">
                <input type="number" name="quantity" class="form-control form-control-sm" 
                       placeholder="Qty" min="1" max="{{ item.quantity }}" 
                       value="{{ item.quantity }}" style="width: 80px;" required>
                <button type="submit" class="btn btn-success btn-sm">
                  <i class="bi bi-receipt"></i> Generate Bill
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="5" class="text-muted py-4">
              No inventory items available. Add products and update stock.
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

</div>
{% endblock content %}
